---
description: 'Update : 2024.01.08'
---

# 4. 연결 테스트

이제 Client에서 "reservation", "parking" 서비스에 접근하기 위한 준비와 테스트를 수행해 봅니다.

아래와 같은 구성으로 시험할 것입니다.

<figure><img src="../.gitbook/assets/image (29).png" alt=""><figcaption></figcaption></figure>

## 1.연결 테스트



### Step1. 연결 테스트를 위한 준비

"2.Service 생성"에서 만든 "reservation", "parking"은 private dns가 자동으로 생성되어 있습니다.&#x20;

Client VPC의 Client EC2들이 해당 DNS 이름으로 연결할 것입니다.

해당 DNS들에 대한 정보를 아래 Shell을 실행해서 Cloud9에서 저장해 둡니다.

```
#service domain name 확인
aws vpc-lattice list-services
aws vpc-lattice list-services | jq -r '.items[].dnsEntry.domainName' | grep 'reservation'
aws vpc-lattice list-services | jq -r '.items[].dnsEntry.domainName' | grep 'parking'
export reservation_svc_dns=$(aws vpc-lattice list-services | jq -r '.items[].dnsEntry.domainName' | grep 'reservation')
export parking_svc_dns=$(aws vpc-lattice list-services | jq -r '.items[].dnsEntry.domainName' | grep 'parking')
echo "export reservation_svc_dns=${reservation_svc_dns}" | tee -a ~/.bash_profile
echo "export parking_svc_dns=${parking_svc_dns}" | tee -a ~/.bash_profile

```

VPC Lattice 콘솔에서도 Service Domain 이름을 확인할 수 있습니다.

* VPC Lattice - Service - Service 선택 - Associated resource summary - Domain name

<figure><img src="../.gitbook/assets/image (30).png" alt=""><figcaption></figcaption></figure>

아래 Shell을 실행해서, Cloud9 Session Manager에서 Client VPC의 Client들의 EC2 id를 연결하기 쉽게 준비해 둡니다.

```
#Cloud9 에서 Session Manager를 통해서 Client에 연결
~/environment/vpclattice/cloud9/client_export.sh

```

### Step2. Service 연결 시험

Cloud9 콘솔에서 terminal 을 실행하고, 아래와 같이 Shell을 실행해서 Client VPC의 Client1에 접속합니다.

```
source ~/.bash_profile
aws ssm start-session --target $InstanceClient1

```

InstanceClient1 에서 아래와 같이 reservation 서비스에 연결해 봅니다. Lambda 자원이 배치된 서비스 입니다.

```
# 앞서 확인한 reservation dns name을 입력합니다.
curl https://reservation-dns-name

```

아래와 같이 "reservation" 서비스에 대한 응답이 결과로 출력 됩니다.

```
<html>
    <head>
    <title>Hello From Lattice Reservations!</title>
    <style>
    html, body {
    margin: 0; padding: 0;
    font-family: arial; font-weight: 700; font-size: 3em;
    text-align: center;
    }
    </style>
    </head>
    <body>
    <p>Hello From Lattice Reservations!</p>
    </body>
    </html>sh-4.2$ 
```



InstanaceClient1 에서 아래와 같이 parking 서비스 /rates에 연결해 봅니다. EC2 자원이 배치된 서비스 입니다.

```
# 앞서 확인한 parking dns name을 입력하고, /rates 를 추가합니다.
curl http://parking-dns-name/rates
```

아래와 같이 "rates" 서비스에서 응답을 합니다.

```
Hello from "rates"
```

InstanceClient1 에서 아래와 같이 parking 서비스 / payments에 연결해 봅니다. ALB 자원이 배치된 서비스 입니다.

```
# 앞서 확인한 reservation dns name을 입력하고, /payments 를 추가합니다.
curl http://parking-dns-name/paymetns
```

아래와 같이 "payments" 서비스에서 응답을 합니다.

```
Hello from "payments"
```

